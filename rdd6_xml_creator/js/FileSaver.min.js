/* FileSaver.js
 *  A saveAs() & saveTextAs() FileSaver implementation.
 *  2014-06-24
 *
 *  Modify by Brian Chen
 *  Author: Eli Grey, http://eligrey.com
 *  License: X11/MIT
 *    See https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md
 *//*global self *//*jslint bitwise: true, indent: 4, laxbreak: true, laxcomma: true, smarttabs: true, plusplus: true *//*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */var saveAs=saveAs||typeof navigator!="undefined"&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(e){"use strict";if(typeof navigator!="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent))return;var t=e.document,n=function(){return e.URL||e.webkitURL||e},r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),i=!e.externalHost&&"download"in r,s=function(n){var r=t.createEvent("MouseEvents");r.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(r)},o=e.webkitRequestFileSystem,u=e.requestFileSystem||o||e.mozRequestFileSystem,a=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},f="application/octet-stream",l=0,c=[],h=function(){var e=c.length;while(e--){var t=c[e];typeof t=="string"?n().revokeObjectURL(t):t.remove()}c.length=0},p=function(e,t,n){t=[].concat(t);var r=t.length;while(r--){var i=e["on"+t[r]];if(typeof i=="function")try{i.call(e,n||e)}catch(s){a(s)}}},d=function(t,a){var h=this,d=t.type,v=!1,m,g,y=function(){var e=n().createObjectURL(t);return c.push(e),e},b=function(){p(h,"writestart progress write writeend".split(" "))},w=function(){if(v||!m)m=y(t);g?g.location.href=m:window.open(m,"_blank"),h.readyState=h.DONE,b()},E=function(e){return function(){if(h.readyState!==h.DONE)return e.apply(this,arguments)}},S={create:!0,exclusive:!1},x;h.readyState=h.INIT,a||(a="download");if(i){m=y(t),r.href=m,r.download=a,s(r),h.readyState=h.DONE,b();return}e.chrome&&d&&d!==f&&(x=t.slice||t.webkitSlice,t=x.call(t,0,t.size,f),v=!0),o&&a!=="download"&&(a+=".download");if(d===f||o)g=e;if(!u){w();return}l+=t.size,u(e.TEMPORARY,l,E(function(e){e.root.getDirectory("saved",S,E(function(e){var n=function(){e.getFile(a,S,E(function(e){e.createWriter(E(function(n){n.onwriteend=function(t){g.location.href=e.toURL(),c.push(e),h.readyState=h.DONE,p(h,"writeend",t)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&w()},"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=h["on"+e]}),n.write(t),h.abort=function(){n.abort(),h.readyState=h.DONE},h.readyState=h.WRITING}),w)}),w)};e.getFile(a,{create:!1},E(function(e){e.remove(),n()}),E(function(e){e.code===e.NOT_FOUND_ERR?n():w()}))}),w)}),w)},v=d.prototype,m=function(e,t){return new d(e,t)};return v.abort=function(){var e=this;e.readyState=e.DONE,p(e,"abort")},v.readyState=v.INIT=0,v.WRITING=1,v.DONE=2,v.error=v.onwritestart=v.onprogress=v.onwrite=v.onabort=v.onerror=v.onwriteend=null,e.addEventListener("unload",h,!1),m.unload=function(){h(),e.removeEventListener("unload",h,!1)},m}(typeof self!="undefined"&&self||typeof window!="undefined"&&window||this.content);typeof module!="undefined"&&module!==null?module.exports=saveAs:typeof define!="undefined"&&define!==null&&define.amd!=null&&define([],function(){return saveAs}),String.prototype.endsWithAny=function(){var e=Array.prototype.slice.call(arguments),t=this.toLowerCase().toString();for(var n=0;n<e.length;n++)if(t.indexOf(e[n],t.length-e[n].length)!==-1)return!0;return!1};var saveTextAs=saveTextAs||function(e,t,n){t=t||"download.txt",n=n||"utf-8",e=(e||"").replace(/\r?\n/g,"\r\n");if(saveAs&&Blob){var r=new Blob([e],{type:"text/plain;charset="+n});return saveAs(r,t),!0}var i=window.frames.saveTxtWindow;if(!i){i=document.createElement("iframe"),i.id="saveTxtWindow",i.style.display="none",document.body.insertBefore(i,null),i=window.frames.saveTxtWindow;if(!i){i=window.open("","_temp","width=100,height=100");if(!i)return window.alert("Sorry, download file could not be created."),!1}}var s=i.document;s.open("text/html","replace"),s.charset=n,t.endsWithAny(".htm",".html")?(s.close(),s.body.innerHTML="\r\n"+e+"\r\n"):(t.endsWithAny(".txt")||(t+=".txt"),s.write(e),s.close());var o=s.execCommand("SaveAs",null,t);return i.close(),o};